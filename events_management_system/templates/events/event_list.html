{% extends "base.html" %} {% load static %} {% block title %}Events{% endblock %} {% block content %}
<h1 class="table-heading-h1">Events</h1>

<div class="table100">
    <table>
        <thead>
            <tr>
                <th class="column1">Name</th>
                <th class="column2">Description</th>
                <th class="column3">Start Date</th>
                <th class="column4">End Date</th>
                <th class="column5">Location</th>
                <th class="column6">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
            <tr>
                <td class="column1">{{ event.name }}</td>
                <td class="column2">{{ event.description }}</td>
                <td class="column3">{{ event.start_date | date }}</td>
                <td class="column4">{{ event.end_date | date }}</td>
                <td class="column5">{{ event.location }}</td>
                <td class="column6">
                    <button id="button-{{ event.id }}" class="styled"
                        onclick="subscribe_to_event({{ event.id}})">Subscribe</button>
                </td>
            </tr>
            {% empty %}
            <p>No events at the moment.</p>
            {% endfor %}
        </tbody>
    </table>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script>
    function subscribe_to_event(event_id) {
        console.log("subscribe_to_event", event_id);
        $(document).ready(function() {
            $.ajax({
                url: "/events/" + event_id + "/subscription/",
                type: "POST",
                success: function(data) {
                    console.log("success", data);
                    $("#button-" + event_id).text("Unsubscribe");
                    $("#button-" + event_id).attr("onclick", "unsubscribe_from_event(" + event_id + ")");
                }
            });
        });
    }
</script>

{% endblock content %}